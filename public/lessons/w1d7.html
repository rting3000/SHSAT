<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>W1D7: Weekly Review</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <div class="container">
        <header id="lesson-header"></header>
        <div id="lesson-deck"></div>
        <div id="results-screen" style="display: none;"></div>
    </div>

    <script>
        const lessonData = {
            title: "Week 1 Comprehensive Review",
            subtitle: "Day 7: Test Your Knowledge",
            pointsPerQuestion: 10,
            completion_id: 'w1d7',
            steps: [
                {
                    type: 'briefing',
                    header: 'Briefing: Week 1 Gauntlet',
                    content: `
                        <p>Welcome to your first weekly review. This is a comprehensive test of everything you've learned in Week 1, from ELA concepts like main idea and paragraph structure to Math fundamentals like ratios, rates, and percentages.</p>
                        <p>There are 30 questions in this review. Take your time, read carefully, and show what you've learned. Good luck!</p>
                    `
                },
                // Question 1: Main Idea
                {
                    type: 'mcq',
                    header: 'Review 1: Main Idea',
                    passage: 'The Roman road network was one of the empire\'s greatest achievements. Spanning over 50,000 miles, these roads were expertly engineered with layers of crushed stone and pavers. They facilitated the rapid movement of troops, trade goods, and communication, effectively binding the vast empire together.',
                    prompt: 'The central idea of this passage is that the Roman road network was:',
                    options: [
                        'Impressively long.',
                        'An engineering marvel crucial to the empire\'s cohesion.',
                        'Primarily used for trade.',
                        'Built with crushed stone.'
                    ],
                    correctAnswer: 'An engineering marvel crucial to the empire\'s cohesion.',
                    explanation: 'This choice best summarizes the passage by including both the engineering aspect and the vital function of the roads in unifying the empire.'
                },
                // Question 2: Averages
                {
                    type: 'grid-in',
                    header: 'Review 2: Averages',
                    prompt: 'The average of five numbers is 20. If four of the numbers are 15, 18, 22, and 25, what is the fifth number?',
                    correctAnswer: '20',
                    explanation: 'If the average of five numbers is 20, their sum must be 5 * 20 = 100. The sum of the four given numbers is 15 + 18 + 22 + 25 = 80. Therefore, the fifth number must be 100 - 80 = 20.'
                },
                // Question 3: Scrambled Paragraph
                {
                    type: 'scrambled-paragraph',
                    header: 'Review 3: Scrambled Paragraph',
                    prompt: 'Choose the most logical order for the sentences.',
                    sentences: [
                        { id: 'A', 'text': 'This process allows them to convert sunlight into glucose, their food source.' },
                        { id: 'B', 'text': 'Photosynthesis is the fundamental process by which plants create energy.' },
                        { id: 'C', 'text': 'It requires sunlight, water, and carbon dioxide.' },
                        { id: 'D', 'text': 'As a byproduct, it releases the oxygen that most animal life depends on to breathe.' }
                    ],
                    options: ['B, C, A, D', 'A, B, C, D', 'B, A, D, C', 'C, D, B, A'],
                    correctAnswer: 'B, C, A, D',
                    explanation: 'B introduces the topic (photosynthesis). C lists the necessary ingredients. A explains what the process achieves for the plant. D explains its crucial byproduct for others.'
                },
                // Question 4: Percentages
                {
                    type: 'grid-in',
                    header: 'Review 4: Percentages',
                    prompt: 'A city has a population of 200,000. If the population increases by 5%, what is the new population?',
                    correctAnswer: '210000',
                    explanation: 'The increase is 5% of 200,000, which is 0.05 * 200,000 = 10,000. The new population is 200,000 + 10,000 = 210,000.'
                },
                // Question 5: Author's Purpose
                {
                    type: 'mcq',
                    header: 'Review 5: Author\'s Purpose',
                    passage: 'The old lighthouse has stood watch over these shores for two centuries. It has guided countless ships through treacherous storms and is a beloved symbol of our town\'s maritime heritage. Now, it faces demolition due to budget cuts. We must not let this piece of our history vanish.',
                    prompt: 'The author\'s main purpose is to:',
                    options: [
                        'Explain how lighthouses work.',
                        'Persuade readers to save the historic lighthouse.',
                        'Tell a fictional story about a lighthouse keeper.',
                        'Analyze the town budget.'
                    ],
                    correctAnswer: 'Persuade readers to save the historic lighthouse.',
                    explanation: 'The passage highlights the lighthouse\'s historical and emotional value and ends with a direct plea ("We must not let..."), indicating a persuasive intent.'
                },
                // Question 6: Ratios
                {
                    type: 'grid-in',
                    header: 'Review 6: Ratios',
                    prompt: 'In a fruit basket, the ratio of apples to oranges is 4:5. If there are 36 fruits in total, how many are oranges?',
                    correctAnswer: '20',
                    explanation: 'The total number of ratio parts is 4 + 5 = 9. Divide the total fruits by the total parts: 36 / 9 = 4 fruits per part. Oranges account for 5 parts, so 5 * 4 = 20 oranges.'
                },
                // Question 7: Inference
                {
                    type: 'mcq',
                    header: 'Review 7: Inference',
                    passage: 'When the power went out, Maria didn\'t panic. She calmly located a flashlight, checked on her younger brother, and then lit the candles she kept for just such an occasion. She spent the rest of the evening reading a book.',
                    prompt: 'What can one infer about Maria?',
                    options: [
                        'She dislikes electricity.',
                        'She is resourceful and composed.',
                        'She caused the power outage.',
                        'She was scared of the dark.'
                    ],
                    correctAnswer: 'She is resourceful and composed.',
                    explanation: 'Her calm, logical actions (finding a flashlight, lighting candles) show that she is composed and well-prepared, indicating resourcefulness.'
                },
                // Question 8: Probability
                {
                    type: 'mcq',
                    header: 'Review 8: Probability',
                    prompt: 'A standard six-sided die is rolled. What is the probability of rolling a number greater than 4?',
                    options: ['1/6', '1/3', '1/2', '2/3'],
                    correctAnswer: '1/3',
                    explanation: 'The numbers greater than 4 on a six-sided die are 5 and 6. That is 2 favorable outcomes out of 6 possible outcomes. The probability is 2/6, which simplifies to 1/3.'
                },
                // Question 9: Revising/Editing
                {
                    type: 'mcq',
                    header: 'Review 9: Revising/Editing',
                    prompt: 'Which choice is the best way to write the underlined part of the sentence? "The reason I was late is because the traffic was heavy."',
                    options: [
                        'is because the traffic was heavy.',
                        'was because the traffic was heavy.',
                        'is that the traffic was heavy.',
                        'is since the traffic was heavy.'
                    ],
                    correctAnswer: 'is that the traffic was heavy.',
                    explanation: 'The phrase "The reason is because" is redundant. The correct and more concise phrasing is "The reason is that..."'
                },
                // Question 10: Proportions
                {
                    type: 'grid-in',
                    header: 'Review 10: Proportions',
                    prompt: 'A recipe for 4 people calls for 2 cups of rice. How much rice is needed if you are cooking for 10 people?',
                    correctAnswer: '5',
                    explanation: 'Set up a proportion: 2 cups / 4 people = x cups / 10 people. The unit rate is 0.5 cups per person. For 10 people, you would need 10 * 0.5 = 5 cups.'
                },
                // Question 11
                {
                    type: 'mcq',
                    header: 'Review 11: Punctuation',
                    prompt: 'Which sentence is punctuated correctly?',
                    options: [
                        "The teams captain, was a great leader.",
                        "The team's captain was a great leader.",
                        "The teams' captain was a great leader.",
                        "The team captain was a great leader."
                    ],
                    correctAnswer: "The team's captain was a great leader.",
                    explanation: 'The possessive form for a singular noun ("team") is formed by adding an apostrophe and "s".'
                },
                // Question 12
                {
                    type: 'grid-in',
                    header: 'Review 12: Rate Problem',
                    prompt: 'A car travels at 60 miles per hour. How many miles will it travel in 2.5 hours?',
                    correctAnswer: '150',
                    explanation: 'Distance = Speed × Time. So, 60 mph * 2.5 hours = 150 miles.'
                },
                // Question 13
                {
                    type: 'mcq',
                    header: 'Review 13: Vocabulary',
                    prompt: 'Choose the word that is most nearly opposite in meaning to "mitigate".',
                    options: ['Alleviate', 'Intensify', 'Soothe', 'Reduce'],
                    correctAnswer: 'Intensify',
                    explanation: '"Mitigate" means to make something less severe or painful. "Intensify" is the opposite.'
                },
                // Question 14
                {
                    type: 'grid-in',
                    header: 'Review 14: Solving for x',
                    prompt: 'If 3x + 5 = 20, what is the value of x?',
                    correctAnswer: '5',
                    explanation: 'Subtract 5 from both sides: 3x = 15. Then, divide by 3: x = 5.'
                },
                // Question 15
                {
                    type: 'mcq',
                    header: 'Review 15: Logical Reasoning',
                    passage: 'All students in the music program must attend the concert. Sarah is in the music program. Therefore, ______.',
                    prompt: 'Which statement best completes the paragraph?',
                    options: [
                        'Sarah might go to the concert.',
                        'Sarah must go to the concert.',
                        'Sarah does not like concerts.',
                        'The concert is for music students.'
                    ],
                    correctAnswer: 'Sarah must go to the concert.',
                    explanation: 'The first sentence sets a rule for all members. The second sentence confirms Sarah is a member. The logical conclusion is that the rule applies to her.'
                },
                // Question 16
                {
                    type: 'grid-in',
                    header: 'Review 16: Geometry',
                    prompt: 'A rectangle has a length of 12 cm and a width of 8 cm. What is its area in square cm?',
                    correctAnswer: '96',
                    explanation: 'The area of a rectangle is length × width. So, 12 cm * 8 cm = 96 cm².'
                },
                // Question 17
                {
                    type: 'mcq',
                    header: 'Review 17: Sentence Fragment',
                    prompt: 'Which of the following is a sentence fragment?',
                    options: [
                        'The sun rises.',
                        'Although she felt tired.',
                        'Go to the store.',
                        'The cat slept.'
                    ],
                    correctAnswer: 'Although she felt tired.',
                    explanation: 'This is a dependent clause. It has a subject and a verb, but it cannot stand alone as a complete thought.'
                },
                // Question 18
                {
                    type: 'grid-in',
                    header: 'Review 18: Order of Operations',
                    prompt: 'What is the value of 10 - 2 * (3 + 1)?',
                    correctAnswer: '2',
                    explanation: 'Follow PEMDAS. Parentheses first: (3 + 1) = 4. Then multiplication: 2 * 4 = 8. Finally, subtraction: 10 - 8 = 2.'
                },
                // Question 19
                {
                    type: 'mcq',
                    header: 'Review 19: Paragraph Organization',
                    prompt: 'Which sentence does not belong in the paragraph?',
                    passage: '(1) The sun provides the energy for almost all life on Earth. (2) Plants use sunlight to create food through photosynthesis. (3) The sun is a star, a massive ball of hot gas. (4) Animals then get energy by eating plants or other animals. (5) This flow of energy is crucial for ecosystems.',
                    options: ['Sentence 2', 'Sentence 3', 'Sentence 4', 'Sentence 5'],
                    correctAnswer: 'Sentence 3',
                    explanation: 'The paragraph is about the flow of energy from the sun through ecosystems. Sentence 3, which describes what the sun is made of, is a detail that distracts from this main idea.'
                },
                // Question 20
                {
                    type: 'grid-in',
                    header: 'Review 20: Probability',
                    prompt: 'A bag contains 3 red marbles and 2 blue marbles. What is the probability of drawing a red marble?',
                    passage: 'Express your answer as a percentage.',
                    correctAnswer: '60',
                    explanation: 'There are 3 red marbles and a total of 5 marbles (3 + 2). The probability is 3/5, which is equal to 60%.'
                },
                // Question 21
                 {
                    type: 'mcq',
                    header: 'Review 21: Wordiness',
                    prompt: 'Which of the following sentences is the most concise?',
                    options: [
                        'At this point in time, we should probably go ahead and get started.',
                        'It is time for us to begin now.',
                        'We should begin.',
                        'The time is now for us to make a start.'
                    ],
                    correctAnswer: 'We should begin.',
                    explanation: 'This option cuts out all the filler words like "At this point in time" and "go ahead and" to state the idea directly.'
                },
                // Question 22
                {
                    type: 'grid-in',
                    header: 'Review 22: Percent Discount',
                    prompt: 'A jacket originally costing $80 is on sale for 25% off. What is the new price in dollars?',
                    correctAnswer: '60',
                    explanation: 'First, find the discount amount: 25% of $80 is (0.25 * 80) = $20. Then, subtract the discount from the original price: $80 - $20 = $60.'
                },
                // Question 23
                {
                    type: 'scrambled-paragraph',
                    header: 'Review 23: Scrambled Paragraph',
                    prompt: 'Choose the best order to form a coherent paragraph.',
                    sentences: [
                        { id: 'W', text: 'This process, called photosynthesis, converts light energy into chemical energy.' },
                        { id: 'X', text: 'The primary role of leaves on a plant is to produce food.' },
                        { id: 'Y', text: 'This energy is then stored as sugar, which fuels the plant\'s growth.' },
                        { id: 'Z', text: 'They do this by absorbing sunlight and carbon dioxide from the air.' }
                    ],
                    options: ['X, W, Y, Z', 'X, Z, W, Y', 'Z, Y, W, X', 'W, X, Z, Y'],
                    correctAnswer: 'X, Z, W, Y',
                    explanation: 'The logical flow is X, Z, W, Y. Sentence X states the main topic (the role of leaves). Sentence Z explains *how* they perform this role. Sentence W gives the name for this process. Sentence Y explains the result of the process.'
                },
                // Question 24
                {
                    type: 'mcq',
                    header: 'Review 24: Verb Tense',
                    prompt: 'Choose the correct verb to complete the sentence.',
                    passage: 'By the time the guests arrived, she _______ the entire meal.',
                    options: ['cooks', 'had cooked', 'is cooking', 'will cook'],
                    correctAnswer: 'had cooked',
                    explanation: 'The phrase "By the time" indicates an action that was completed before another past action. This requires the past perfect tense, "had cooked".'
                },
                // Question 25
                {
                    type: 'grid-in',
                    header: 'Review 25: Reverse Percentage',
                    prompt: 'After a 15% discount, a phone costs $340. What was its original price in dollars?',
                    correctAnswer: '400',
                    explanation: 'If the phone was discounted by 15%, the current price is 100% - 15% = 85% of the original price. Set up the equation: 0.85 * x = 340. Solve for x: x = 340 / 0.85 = 400.'
                },
                // Question 26
                {
                    type: 'mcq',
                    header: 'Review 26: Spelling',
                    prompt: 'Which word is spelled correctly?',
                    options: ['Accomodate', 'Reccomend', 'Necessary', 'Definately'],
                    correctAnswer: 'Necessary',
                    explanation: 'The correct spellings are "accommodate", "recommend", and "definitely". "Necessary" is spelled correctly.'
                },
                // Question 27
                {
                    type: 'grid-in',
                    header: 'Review 27: Multi-step Percentage',
                    prompt: 'A store buys a jacket for $80. They mark it up by 50%. Then, they sell it at a 20% discount off the marked-up price. What is the final selling price in dollars?',
                    correctAnswer: '96',
                    explanation: 'First, find the marked-up price: $80 * 1.50 = $120. Then, find the discount amount on the new price: 20% of $120 is (0.20 * 120) = $24. Finally, subtract the discount: $120 - $24 = $96.'
                },
                // Question 28
                {
                    type: 'mcq',
                    header: 'Review 28: Inference',
                    passage: 'The first week it was open, you couldn\'t get a table without a reservation. By the second month, the dining room was half-empty on a Saturday night. Now, the windows are dark and a "For Lease" sign hangs in the window.',
                    prompt: 'What can you infer about the new restaurant?',
                    options: [
                        'The restaurant became too popular to manage.',
                        'The restaurant moved to a new, better location.',
                        'The restaurant\'s food was excellent.',
                        'The restaurant was initially popular but quickly failed.'
                    ],
                    correctAnswer: 'The restaurant was initially popular but quickly failed.',
                    explanation: 'The passage shows a clear progression: initial success (full), declining popularity (half-empty), and final failure ("For Lease" sign). this allows us to infer a rapid decline.'
                },
                // Question 29
                {
                    type: 'grid-in',
                    header: 'Review 29: Probability',
                    prompt: 'A spinner is divided into 8 equal sections, numbered 1 through 8. What is the probability of spinning a number less than 4?',
                    passage: 'Express your answer as a percentage.',
                    correctAnswer: '37.5',
                    explanation: 'The numbers less than 4 are 1, 2, and 3. That makes 3 favorable outcomes out of 8 total possible outcomes. The probability is 3/8, which is 37.5%.'
                },
                // Question 30
                {
                    type: 'mcq',
                    header: 'Review 30: Clarity',
                    prompt: 'Choose the clearest revision.',
                    passage: 'After mixing the chemicals, the solution turned blue, which was interesting.',
                    options: [
                        'The solution turned blue after mixing the chemicals, and it was interesting.',
                        'It was interesting that the solution turned blue after mixing the chemicals.',
                        'The chemist found it interesting that the solution turned blue after the chemicals were mixed.',
                        'The interesting solution turned blue after mixing the chemicals.'
                    ],
                    correctAnswer: 'The chemist found it interesting that the solution turned blue after the chemicals were mixed.',
                    explanation: 'The original sentence has a vague "which". This revision clarifies who found the result interesting (the chemist).'
                }
            ]
        };

        // Standard lesson engine script
        document.addEventListener('DOMContentLoaded', () => {
            const lessonHeader = document.getElementById('lesson-header');
            const lessonDeck = document.getElementById('lesson-deck');
            const resultsScreen = document.getElementById('results-screen');
            const completionId = lessonData.completion_id;

            let currentStep = 0;
            let score = 0;
            let questionsAnswered = 0;
            let completedQuestions = new Set(JSON.parse(localStorage.getItem(completionId)) || []);

            function startLesson() {
                lessonHeader.innerHTML = `<h1>${lessonData.title}</h1><p>${lessonData.subtitle}</p><a href="../index.html" class="back-link">Back to Dashboard</a>`;
                showStep(currentStep);
            }

            function showStep(stepIndex) {
                const step = lessonData.steps[stepIndex];
                if (!step) {
                    showFinalResults();
                    return;
                }

                const card = document.createElement('div');
                card.className = 'card active';

                let content = `<h2>${step.header}</h2>`;
                 if (step.passage) {
                    // In scrambled paragraphs, the passage is the set of sentences to be ordered.
                    if (step.type === 'scrambled-paragraph') {
                         content += `<div class="passage">${step.prompt}</div>`;
                         content += '<ul class="scrambled-sentences">';
                         step.sentences.forEach(sentence => {
                            content += `<li><strong>${sentence.id}:</strong> ${sentence.text}</li>`;
                         });
                         content += '</ul>';
                    } else {
                         content += `<div class="passage">${step.passage}</div>`;
                         content += `<p class="prompt">${step.prompt}</p>`;
                    }
                } else if (step.prompt) {
                     content += `<p class="prompt">${step.prompt}</p>`;
                }


                if (step.type === 'briefing') {
                    content += `<div class="briefing-content">${step.content}</div>`;
                    content += `<div class="button-container"><button id="next-btn">Start</button></div>`;
                } else if (step.type === 'mcq' || step.type === 'scrambled-paragraph') {
                    content += '<div class="options-container">';
                    step.options.forEach(option => {
                        content += `<button class="option">${option}</button>`;
                    });
                    content += '</div>';
                } else if (step.type === 'grid-in') {
                    content += `
                        <div class="grid-in-container">
                            <input type="text" id="grid-in-answer" class="grid-in-input">
                            <button id="grid-in-submit" class="grid-in-submit-btn">Submit</button>
                        </div>
                    `;
                }


                card.innerHTML = content;
                lessonDeck.innerHTML = '';
                lessonDeck.appendChild(card);

                if (step.type === 'briefing') {
                    document.getElementById('next-btn').addEventListener('click', () => {
                        currentStep++;
                        showStep(currentStep);
                    });
                } else if (step.type === 'mcq' || step.type === 'scrambled-paragraph') {
                    document.querySelectorAll('.option').forEach(button => {
                        button.addEventListener('click', (e) => checkAnswer(e.target.innerText));
                    });
                } else if (step.type === 'grid-in') {
                     document.getElementById('grid-in-submit').addEventListener('click', () => {
                        const answer = document.getElementById('grid-in-answer').value;
                        checkAnswer(answer);
                    });
                    document.getElementById('grid-in-answer').addEventListener('keyup', (e) => {
                         if (e.key === 'Enter') {
                            const answer = document.getElementById('grid-in-answer').value;
                            checkAnswer(answer);
                        }
                    });
                }
            }

            function checkAnswer(selectedAnswer) {
                const step = lessonData.steps[currentStep];
                const isCorrect = selectedAnswer.trim().toLowerCase() === step.correctAnswer.trim().toLowerCase();
                
                questionsAnswered++;
                if (isCorrect) {
                    score += lessonData.pointsPerQuestion;
                }

                showFeedback(isCorrect, step.correctAnswer, step.explanation);
            }

            function showFeedback(isCorrect, correctAnswer, explanation) {
                const card = lessonDeck.querySelector('.card');
                const feedbackDiv = document.createElement('div');
                feedbackDiv.className = `feedback ${isCorrect ? 'correct' : 'incorrect'}`;
                feedbackDiv.innerHTML = `
                    <h3>${isCorrect ? 'Correct!' : 'Incorrect'}</h3>
                    <p><strong>The correct answer is:</strong> ${correctAnswer}</p>
                    <p><em>${explanation}</em></p>
                    <div class="button-container"><button id="next-btn">Next</button></div>
                `;

                // Disable all inputs
                card.querySelectorAll('button, input').forEach(el => el.disabled = true);
                card.appendChild(feedbackDiv);
                document.getElementById('next-btn').focus();
                
                document.getElementById('next-btn').addEventListener('click', () => {
                    currentStep++;
                    showStep(currentStep);
                });
            }

            function showFinalResults() {
                const totalQuestions = lessonData.steps.filter(s => s.type !== 'briefing').length;
                const percentage = totalQuestions > 0 ? Math.round((score / (totalQuestions * lessonData.pointsPerQuestion)) * 100) : 0;
                
                lessonDeck.style.display = 'none';
                lessonHeader.style.display = 'none';

                resultsScreen.innerHTML = `
                    <h2>Mission Complete!</h2>
                    <p>You scored</p>
                    <div class="final-score">${percentage}%</div>
                    <p>${score / lessonData.pointsPerQuestion} out of ${totalQuestions} questions correct.</p>
                    <div class="button-container">
                         <a href="../index.html" class="button-link">Back to Dashboard</a>
                    </div>
                `;
                resultsScreen.style.display = 'block';

                // Mark lesson as complete
                 if (percentage >= 80) { // Example threshold for completion
                    const completed = new Set(JSON.parse(localStorage.getItem('completedLessons')) || []);
                    completed.add(completionId);
                    localStorage.setItem('completedLessons', JSON.stringify(Array.from(completed)));
                }
            }

            startLesson();
        });
    </script>
</body>
</html>